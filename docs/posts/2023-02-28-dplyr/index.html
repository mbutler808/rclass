<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marguerite Butler">
<meta name="dcterms.date" content="2023-02-28">
<meta name="description" content="Add">

<title>ZOOL710 Data Science in R for Biologists - Getting data in shape with dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ZOOL710 Data Science in R for Biologists</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-general-information" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">General Information</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-general-information">    
        <li>
    <a class="dropdown-item" href="../../syllabus.html">
 <span class="dropdown-text">Syllabus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../schedule.html">
 <span class="dropdown-text">Schedule</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-course-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Course Materials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-course-materials">    
        <li>
    <a class="dropdown-item" href="../../lectures.html">
 <span class="dropdown-text">Lectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects.html">
 <span class="dropdown-text">Projects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources.html">
 <span class="dropdown-text">Resources</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Getting data in shape with dplyr</h1>
                  <div>
        <div class="description">
          Add
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">module 3</div>
                <div class="quarto-category">week 7</div>
                <div class="quarto-category">tidyr</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">dplyr</div>
                <div class="quarto-category">tibble</div>
                <div class="quarto-category">pipe</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <a href="https://butlerlab.org">Marguerite Butler</a> 
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              School of Life Sciences, University of Hawaii
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 28, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pre-lecture-materials" id="toc-pre-lecture-materials" class="nav-link active" data-scroll-target="#pre-lecture-materials">Pre-lecture materials</a>
  <ul class="collapse">
  <li><a href="#read-ahead" id="toc-read-ahead" class="nav-link" data-scroll-target="#read-ahead">Read ahead</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  </ul></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy data</a></li>
  <li><a href="#what-shapes-does-the-data-need-to-be-in" id="toc-what-shapes-does-the-data-need-to-be-in" class="nav-link" data-scroll-target="#what-shapes-does-the-data-need-to-be-in">What shapes does the data need to be in?</a></li>
  <li><a href="#tibbles" id="toc-tibbles" class="nav-link" data-scroll-target="#tibbles">Tibbles</a>
  <ul class="collapse">
  <li><a href="#tibble-constructor" id="toc-tibble-constructor" class="nav-link" data-scroll-target="#tibble-constructor"><code>tibble()</code> constructor</a></li>
  <li><a href="#as_tibble-coersion" id="toc-as_tibble-coersion" class="nav-link" data-scroll-target="#as_tibble-coersion"><code>as_tibble()</code> coersion</a></li>
  <li><a href="#as-output" id="toc-as-output" class="nav-link" data-scroll-target="#as-output">As output</a></li>
  </ul></li>
  <li><a href="#the-dplyr-package" id="toc-the-dplyr-package" class="nav-link" data-scroll-target="#the-dplyr-package">The <strong>dplyr</strong> package</a>
  <ul class="collapse">
  <li><a href="#dplyr-functions" id="toc-dplyr-functions" class="nav-link" data-scroll-target="#dplyr-functions"><code>dplyr</code> functions</a></li>
  <li><a href="#starwars-dataset" id="toc-starwars-dataset" class="nav-link" data-scroll-target="#starwars-dataset"><code>starwars</code> dataset</a></li>
  <li><a href="#selecting-columns-with-select" id="toc-selecting-columns-with-select" class="nav-link" data-scroll-target="#selecting-columns-with-select">Selecting columns with <code>select()</code></a></li>
  <li><a href="#subsetting-with-filter" id="toc-subsetting-with-filter" class="nav-link" data-scroll-target="#subsetting-with-filter">Subsetting with <code>filter()</code></a></li>
  <li><a href="#sorting-data-with-arrange" id="toc-sorting-data-with-arrange" class="nav-link" data-scroll-target="#sorting-data-with-arrange">Sorting data with <code>arrange()</code></a></li>
  <li><a href="#renaming-columns-with-rename" id="toc-renaming-columns-with-rename" class="nav-link" data-scroll-target="#renaming-columns-with-rename">Renaming columns with <code>rename()</code></a></li>
  <li><a href="#adding-columns-with-mutate" id="toc-adding-columns-with-mutate" class="nav-link" data-scroll-target="#adding-columns-with-mutate">Adding columns with <code>mutate()</code></a></li>
  <li><a href="#perform-functions-on-groups-using-group_by" id="toc-perform-functions-on-groups-using-group_by" class="nav-link" data-scroll-target="#perform-functions-on-groups-using-group_by">Perform functions on groups using <code>group_by()</code></a></li>
  <li><a href="#piping-multiple-functions-using" id="toc-piping-multiple-functions-using" class="nav-link" data-scroll-target="#piping-multiple-functions-using">Piping multiple functions using <code>%&gt;%</code></a></li>
  <li><a href="#sample-rows-of-data-with-slice_" id="toc-sample-rows-of-data-with-slice_" class="nav-link" data-scroll-target="#sample-rows-of-data-with-slice_">Sample rows of data with <code>slice_*()</code></a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#post-lecture-materials" id="toc-post-lecture-materials" class="nav-link" data-scroll-target="#post-lecture-materials">Post-lecture materials</a>
  <ul class="collapse">
  <li><a href="#final-questions" id="toc-final-questions" class="nav-link" data-scroll-target="#final-questions">Final Questions</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<!-- Add interesting quote -->
<section id="pre-lecture-materials" class="level1">
<h1>Pre-lecture materials</h1>
<!-- R emoji aliases:  https://gist.github.com/rxaviers/7360908 -->
<p>üå¥</p>
<section id="read-ahead" class="level3">
<h3 class="anchored" data-anchor-id="read-ahead">Read ahead</h3>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Read ahead
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Before class, you can prepare by reading the following materials:</strong></p>
<ol type="1">
<li><a href="https://r4ds.had.co.nz/tibbles" class="uri">https://r4ds.had.co.nz/tibbles</a></li>
<li><a href="https://jhudatascience.org/tidyversecourse/wrangle-data.html#data-wrangling" class="uri">https://jhudatascience.org/tidyversecourse/wrangle-data.html#data-wrangling</a></li>
<li><a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">dplyr cheat sheet from RStudio</a></li>
</ol>
</div>
</div>
</section>
<section id="acknowledgements" class="level3">
<h3 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>Material for this lecture was borrowed and adopted from</p>
<ul>
<li><a href="https://www.stephaniehicks.com/jhustatcomputing2022/posts/2022-09-06-managing-data-frames-with-tidyverse/" class="uri">https://www.stephaniehicks.com/jhustatcomputing2022/posts/2022-09-06-managing-data-frames-with-tidyverse/</a></li>
<li><a href="https://rdpeng.github.io/Biostat776/lecture-managing-data-frames-with-the-tidyverse" class="uri">https://rdpeng.github.io/Biostat776/lecture-managing-data-frames-with-the-tidyverse</a></li>
<li><a href="https://jhudatascience.org/tidyversecourse/get-data.html#tibbles" class="uri">https://jhudatascience.org/tidyversecourse/get-data.html#tibbles</a></li>
</ul>
</section>
</section>
<section id="learning-objectives" class="level1">
<h1>Learning objectives</h1>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>At the end of this lesson you will:</strong></p>
<ul>
<li>Understand the tools available to get data into the proper structure and shape for downstream analyses</li>
<li>Learn about the dplyr R package to manage data frames</li>
<li>Recognize the key verbs (functions) to manage data frames in dplyr</li>
<li>Use the ‚Äúpipe‚Äù operator to combine verbs together</li>
</ul>
</div>
</div>
</section>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>It is still important to understand base R manipulations, particularly for things such as cleaning raw data, troubleshooting, and writing custom functions. But the tidyverse provides many useful tools for data manipuation and analysis of cleaned data. In this session we will learn about <strong>dplyr</strong> and friends.</p>
</section>
<section id="tidy-data" class="level1">
<h1>Tidy data</h1>
<p>The tidyverse has many slogans. A particularly good one for all data analysis is the notion of <strong>tidy data</strong>.</p>
<p>As defined by Hadley Wickham in his 2014 paper published in the <em>Journal of Statistical Software</em>, a <a href="https://www.jstatsoft.org/article/view/v059i10">tidy dataset</a> has the following properties:</p>
<ol type="1">
<li><p>Each variable forms a column.</p></li>
<li><p>Each observation forms a row.</p></li>
<li><p>Each type of observational unit forms a table.</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/tidydata_1.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Artwork by Allison Horst on tidy data</figcaption><p></p>
</figure>
</div>
<p>[<strong>Source</strong>: <a href="https://github.com/allisonhorst/stats-illustrations">Artwork by Allison Horst</a>]</p>
</section>
<section id="what-shapes-does-the-data-need-to-be-in" class="level1">
<h1>What shapes does the data need to be in?</h1>
<p>Beyond the data being tidy, however, we also need to think about what shape it needs to be in. We ªll review concepts and tools in the next two lessons.</p>
<p>Now that we have had some experience plotting our data, we can see the value of having rectangular dataframes. We can also see that for particular graphics and analyses, we need to have the data arranged in particular ways.</p>
<p>For example, take a look at this elegant graphic below. This single graphic is packed with information on fat, BMR, TEE, and activity levels, all for mulitple species. Is it more effective that individual bar plots? This arrangement is so helpful because you can imagine questions that can be answered with it by comparing the different aspects of the data.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A very informative figure!
</div>
</div>
<div class="callout-body-container callout-body">
<p><img src="../../images/humanTEE.png" class="img-fluid" alt="Human total energy expenditure compared with other primates."> <a href="https://www.science.org/content/article/scientist-busts-myths-about-how-humans-burn-calories-and-why?fbclid=IwAR3fzOwd09LBUOR9ely2t4om0-CtYcuT8ux_f46OopQnpiAVENgX_24bWpY">Source: Gibbons, 2022 based on data of H. Ponzer et al., NATURE, 533:90, 2016</a></p>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Can you imagine what this dataset looks like in terms of organization?
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>First imagine what it would look like variable by variable.</li>
<li>How might you intially plot the data?</li>
<li>What organization would you need to make a single figure such as this?</li>
</ol>
</div>
</div>
<p>We often do not know exactly what we need at the start of a data analysis. We have to play around with different data structures, rearrange the data, look for interesting plots to try, rerrange to fit the input requirements of new functions we ªve discovered, and so on.</p>
</section>
<section id="tibbles" class="level1">
<h1>Tibbles</h1>
<p>The <strong>tidyverse</strong> uses as its central data structure, the <strong>tibble</strong> or <strong>tbl_df</strong>. Tibbles are a variation on data frames, claimed to be <em>lazy</em> and <em>surly</em>:</p>
<ul>
<li>They don‚Äôt change variable names or types when you construct the tibble.</li>
<li>Don‚Äôt convert strings to factors (the default behavior in <code>data.frame()</code>).</li>
<li>Complain more when a variable doesn ªt exist.</li>
<li>No <code>row.names()</code> in a tibble. Instead, you must create a new variable.</li>
<li>Display a different summary style for its <code>print()</code> method.</li>
<li>Allows non-standard R names for variables</li>
<li>Allows columns to be lists.</li>
</ul>
<p>However, most tidyverse functions also work on data frames. It ªs up to you.</p>
<section id="tibble-constructor" class="level3">
<h3 class="anchored" data-anchor-id="tibble-constructor"><code>tibble()</code> constructor</h3>
<p>Just as with data frames, there is a <code>tibble()</code> constructor function, which functions in many ways with similar syntax as the <code>data.frame()</code> constructor.</p>
<p>If you haven ªt already done so, install the tidyverse:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(tibble)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tibble</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>( iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,] )  <span class="co"># the first few rows of iris</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 5
  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
1          5.1         3.5          1.4         0.2 setosa 
2          4.9         3            1.4         0.2 setosa 
3          4.7         3.2          1.3         0.2 setosa 
4          4.6         3.1          1.5         0.2 setosa </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>( x, x <span class="sc">*</span> <span class="dv">2</span> )  <span class="co"># name assigned at construction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
      x `x * 2`
  &lt;int&gt;   &lt;dbl&gt;
1     1       2
2     2       4
3     3       6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>silly <span class="ot">&lt;-</span> <span class="fu">tibble</span>(      <span class="co"># an example of a non-standard names</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">one - 3</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,  <span class="co"># name = value syntax</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">12</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"numeric"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">:)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"smile"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>silly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 3
  `one - 3` `12`    `:)` 
      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;
1         1 numeric smile
2         2 numeric smile
3         3 numeric smile</code></pre>
</div>
</div>
</section>
<section id="as_tibble-coersion" class="level3">
<h3 class="anchored" data-anchor-id="as_tibble-coersion"><code>as_tibble()</code> coersion</h3>
<p><code>as_tibble()</code> converts an existing object, such as a data frame or matrix, into a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>( iris[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,] )  <span class="co"># coercing a dataframe to tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 5
  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
1          5.1         3.5          1.4         0.2 setosa 
2          4.9         3            1.4         0.2 setosa 
3          4.7         3.2          1.3         0.2 setosa 
4          4.6         3.1          1.5         0.2 setosa </code></pre>
</div>
</div>
</section>
<section id="as-output" class="level3">
<h3 class="anchored" data-anchor-id="as-output">As output</h3>
<p>Most often we will get tibbles returned from tidyverse functions such as <code>read_csv()</code> from the <code>readr</code> package.</p>
</section>
</section>
<section id="the-dplyr-package" class="level1">
<h1>The <strong>dplyr</strong> package</h1>
<p>The <strong>dplyr</strong> package, which is part of the <strong>tidyverse</strong> was written to supply a <em>grammar for data manipulation</em>, with verbs for the most common data manipulation tasks.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/dplyr_wrangling.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Artwork by Allison Horst on the dplyr package</figcaption><p></p>
</figure>
</div>
<p>[<strong>Source</strong>: <a href="https://github.com/allisonhorst/stats-illustrations">Artwork by Allison Horst</a>]</p>
<section id="dplyr-functions" class="level3">
<h3 class="anchored" data-anchor-id="dplyr-functions"><code>dplyr</code> functions</h3>
<ul>
<li><p><code>select()</code>: return a subset of the data frame, using a flexible notation</p></li>
<li><p><code>filter()</code>: extract a subset of rows from a data frame using logical conditions</p></li>
<li><p><code>arrange()</code>: reorder rows of a data frame</p></li>
<li><p><code>rename()</code>: rename columns in a data frame</p></li>
<li><p><code>mutate()</code>: add new columns or transform existing variables</p></li>
<li><p><code>summarize()</code>: generate summary statistics of the variables in the data frame, by strata if data are hierarchical</p></li>
<li><p><code>%&gt;%</code>: the ‚Äúpipe‚Äù operator (from <strong>magrittr</strong>) connects multiple verbs together into a data wrangling pipeline (kind of like making a compound sentence)</p></li>
</ul>
<p>Note: Everything <code>dplyr</code> does could already be done with base R. What is different is a new syntax, which allows for more clarity of the data manipulations and the order, and perhaps makes the code more readable.</p>
<p>Instead of the nested syntax, or typing the dataframe name over and over, we can pipe one operation into the next.</p>
<p>Another useful contribution is that <code>dplyr</code> functions are <strong>very</strong> fast, as many key operations are coded in C++. This will be important for very large datasets or repeated manipulations (say in a simulation study).</p>
</section>
<section id="starwars-dataset" class="level3">
<h3 class="anchored" data-anchor-id="starwars-dataset"><code>starwars</code> dataset</h3>
<p>We will use the <code>starwars</code> dataset included with <code>dplyr</code>. You should check out the help page for this dataset <code>?starwars</code>.</p>
<p>Let ªs start by using the <code>skim()</code> function to check out the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: dplyr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(starwars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(starwars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">starwars</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">87</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">list</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">name</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">87</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">hair_color</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">skin_color</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">eye_color</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">gender</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">homeworld</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">species</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: list</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 20%">
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">min_length</th>
<th style="text-align: right;">max_length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">films</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">vehicles</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">starships</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">height</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">174.36</td>
<td style="text-align: right;">34.77</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">167.0</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">191.0</td>
<td style="text-align: right;">264</td>
<td style="text-align: left;">‚ñÅ‚ñÅ‚ñá‚ñÖ‚ñÅ</td>
</tr>
<tr class="even">
<td style="text-align: left;">mass</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">97.31</td>
<td style="text-align: right;">169.46</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">55.6</td>
<td style="text-align: right;">79</td>
<td style="text-align: right;">84.5</td>
<td style="text-align: right;">1358</td>
<td style="text-align: left;">‚ñá‚ñÅ‚ñÅ‚ñÅ‚ñÅ</td>
</tr>
<tr class="odd">
<td style="text-align: left;">birth_year</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">87.57</td>
<td style="text-align: right;">154.69</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">35.0</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">72.0</td>
<td style="text-align: right;">896</td>
<td style="text-align: left;">‚ñá‚ñÅ‚ñÅ‚ñÅ‚ñÅ</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="selecting-columns-with-select" class="level3">
<h3 class="anchored" data-anchor-id="selecting-columns-with-select">Selecting columns with <code>select()</code></h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose we wanted to take the first 3 columns only. There are a few ways to do this.</p>
<p>We could for example use numerical indices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(starwars)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "name"   "height" "mass"  </code></pre>
</div>
</div>
<p>But we can also use the names directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>subset <span class="ot">&lt;-</span> <span class="fu">select</span>(starwars, <span class="fu">c</span>(name, sex<span class="sc">:</span>species))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 5
  name           sex    gender    homeworld species
  &lt;chr&gt;          &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;  
1 Luke Skywalker male   masculine Tatooine  Human  
2 C-3PO          none   masculine Tatooine  Droid  
3 R2-D2          none   masculine Naboo     Droid  
4 Darth Vader    male   masculine Tatooine  Human  
5 Leia Organa    female feminine  Alderaan  Human  
6 Owen Lars      male   masculine Tatooine  Human  </code></pre>
</div>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>:</code> normally cannot be used with names or strings, but inside the <code>select()</code> function you can use it to specify a range of variable names.</p>
</div>
</div>
<section id="by-exclusion" class="level4">
<h4 class="anchored" data-anchor-id="by-exclusion">By exclusion</h4>
<p>Variables can be <strong>omited</strong> using the negative sign withing <code>select()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>( starwars, <span class="sc">-</span>(sex<span class="sc">:</span>species))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>select()</code> function also has several helper functions that allow matching on patterns. So, for example, if you wanted to keep every variable that ends with ‚Äúcolor‚Äù:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>subset <span class="ot">&lt;-</span> <span class="fu">select</span>(starwars, <span class="fu">ends_with</span>(<span class="st">"color"</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [87 √ó 3] (S3: tbl_df/tbl/data.frame)
 $ hair_color: chr [1:87] "blond" NA NA "none" ...
 $ skin_color: chr [1:87] "fair" "gold" "white, blue" "white" ...
 $ eye_color : chr [1:87] "blue" "yellow" "red" "yellow" ...</code></pre>
</div>
</div>
<p>Or all variables that start with n or m:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>subset <span class="ot">&lt;-</span> <span class="fu">select</span>(starwars, <span class="fu">starts_with</span>(<span class="st">"n"</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">"m"</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [87 √ó 2] (S3: tbl_df/tbl/data.frame)
 $ name: chr [1:87] "Luke Skywalker" "C-3PO" "R2-D2" "Darth Vader" ...
 $ mass: num [1:87] 77 75 32 136 49 120 75 32 84 77 ...</code></pre>
</div>
</div>
<p>You can also use more general <strong>regular expressions</strong>. See the help page (<code>?select</code>) for more details.</p>
</section>
</section>
<section id="subsetting-with-filter" class="level3">
<h3 class="anchored" data-anchor-id="subsetting-with-filter">Subsetting with <code>filter()</code></h3>
<p>The <code>filter()</code> function is used to <strong>extract subsets of rows</strong> or observations from a data frame. This function is similar to the existing <code>subset()</code> function in base R, or indexing by logical comparisons.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/dplyr_filter.jpg" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Artwork by Allison Horst on filter() function</figcaption><p></p>
</figure>
</div>
<p>[<strong>Source</strong>: <a href="https://github.com/allisonhorst/stats-illustrations">Artwork by Allison Horst</a>]</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Suppose we wanted to extract the rows of the <code>starwars</code> data frame where the birthyear is greater than 100:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>age100 <span class="ot">&lt;-</span> <span class="fu">filter</span>(starwars, birth_year <span class="sc">&gt;</span> <span class="dv">100</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(age100)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 14
  name         height  mass hair_‚Ä¶¬π skin_‚Ä¶¬≤ eye_c‚Ä¶¬≥ birth‚Ä¶‚Å¥ sex   gender homew‚Ä¶‚Åµ
  &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  
1 C-3PO           167    75 &lt;NA&gt;    gold    yellow      112 none  mascu‚Ä¶ Tatooi‚Ä¶
2 Chewbacca       228   112 brown   unknown blue        200 male  mascu‚Ä¶ Kashyy‚Ä¶
3 Jabba Desil‚Ä¶    175  1358 &lt;NA&gt;    green-‚Ä¶ orange      600 herm‚Ä¶ mascu‚Ä¶ Nal Hu‚Ä¶
4 Yoda             66    17 white   green   brown       896 male  mascu‚Ä¶ &lt;NA&gt;   
5 Dooku           193    80 white   fair    brown       102 male  mascu‚Ä¶ Serenno
# ‚Ä¶ with 4 more variables: species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
#   starships &lt;list&gt;, and abbreviated variable names ¬π‚Äãhair_color, ¬≤‚Äãskin_color,
#   ¬≥‚Äãeye_color, ‚Å¥‚Äãbirth_year, ‚Åµ‚Äãhomeworld</code></pre>
</div>
</div>
</div>
</div>
<p>You can see that there are now only 5 rows in the data frame and the distribution of the <code>birth_year</code> values is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(age100<span class="sc">$</span>birth_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    102     112     200     382     600     896 </code></pre>
</div>
</div>
<p>We can also filter on multiple conditions: <em>and</em> requires both conditions to be true, whereas <em>or</em> requires only one to be true. This time let ªs choose <code>birth_year &lt; 100</code> and <code>homeworld == "Tatooine</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>age_tat <span class="ot">&lt;-</span> <span class="fu">filter</span>(starwars, birth_year <span class="sc">&lt;</span> <span class="dv">100</span> <span class="sc">&amp;</span> homeworld <span class="sc">==</span> <span class="st">"Tatooine"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(age_tat, name, height, mass, birth_year, sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 √ó 5
  name               height  mass birth_year sex   
  &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
1 Luke Skywalker        172    77       19   male  
2 Darth Vader           202   136       41.9 male  
3 Owen Lars             178   120       52   male  
4 Beru Whitesun lars    165    75       47   female
5 Biggs Darklighter     183    84       24   male  
6 Anakin Skywalker      188    84       41.9 male  
7 Shmi Skywalker        163    NA       72   female
8 Cliegg Lars           183    NA       82   male  </code></pre>
</div>
</div>
<p>Other logical operators you should be aware of include:</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 37%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Operator</th>
<th style="text-align: right;">Meaning</th>
<th style="text-align: right;">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><code>==</code></td>
<td style="text-align: right;">Equals</td>
<td style="text-align: right;"><code>homeworld == Tatooine</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>!=</code></td>
<td style="text-align: right;">Does not equal</td>
<td style="text-align: right;"><code>homeworld != Tatooine</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>&gt;</code></td>
<td style="text-align: right;">Greater than</td>
<td style="text-align: right;"><code>height &gt; 170.0</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>&gt;=</code></td>
<td style="text-align: right;">Greater than or equal to</td>
<td style="text-align: right;"><code>height &gt;= 170.0</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>&lt;</code></td>
<td style="text-align: right;">Less than</td>
<td style="text-align: right;"><code>height &lt; 170.0</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>&lt;=</code></td>
<td style="text-align: right;">Less than or equal to</td>
<td style="text-align: right;"><code>height &lt;= 170.0</code></td>
</tr>
<tr class="odd">
<td style="text-align: right;"><code>%in%</code></td>
<td style="text-align: right;">Included in</td>
<td style="text-align: right;"><code>homeworld %in% c("Tatooine", "Naboo")</code></td>
</tr>
<tr class="even">
<td style="text-align: right;"><code>is.na()</code></td>
<td style="text-align: right;">Is a missing value</td>
<td style="text-align: right;"><code>is.na(mass)</code></td>
</tr>
</tbody>
</table>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are ever unsure of how to write a logical statement, but know how to write its opposite, you can use the <code>!</code> operator to negate the whole statement.</p>
<p>A common use of this is to identify observations with non-missing data (e.g., <code>!(is.na(homweworld))</code>).</p>
</div>
</div>
</section>
<section id="sorting-data-with-arrange" class="level3">
<h3 class="anchored" data-anchor-id="sorting-data-with-arrange">Sorting data with <code>arrange()</code></h3>
<p><code>arrange()</code> is like the sort function in a spreadsheet, or <code>order()</code> in base R. <code>arrange()</code> <strong>reorders rows</strong> of a data frame according to one of the columns. Think of this as sorting your rows on the value of a column.</p>
<p>Here we can order the rows of the data frame by birth_year, so that the first row is the earliest (oldest) observation and the last row is the latest (most recent) observation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">arrange</span>(starwars, birth_year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now check the first few rows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(starwars, name, birth_year), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  name                  birth_year
  &lt;chr&gt;                      &lt;dbl&gt;
1 Wicket Systri Warrick          8
2 IG-88                         15
3 Luke Skywalker                19</code></pre>
</div>
</div>
<p>and the last few rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">select</span>(starwars, name, birth_year), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  name           birth_year
  &lt;chr&gt;               &lt;dbl&gt;
1 Poe Dameron            NA
2 BB8                    NA
3 Captain Phasma         NA</code></pre>
</div>
</div>
<p>Columns can be arranged in descending order using the helper function <code>desc()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">arrange</span>(starwars, <span class="fu">desc</span>(birth_year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the first three and last three rows shows the dates in descending order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(starwars, name, birth_year), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  name                  birth_year
  &lt;chr&gt;                      &lt;dbl&gt;
1 Yoda                         896
2 Jabba Desilijic Tiure        600
3 Chewbacca                    200</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">select</span>(starwars, name, birth_year), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 2
  name           birth_year
  &lt;chr&gt;               &lt;dbl&gt;
1 Poe Dameron            NA
2 BB8                    NA
3 Captain Phasma         NA</code></pre>
</div>
</div>
</section>
<section id="renaming-columns-with-rename" class="level3">
<h3 class="anchored" data-anchor-id="renaming-columns-with-rename">Renaming columns with <code>rename()</code></h3>
<p><strong>Renaming a variable</strong> in a data frame in R is accomplished using the <code>names()</code> function. The <code>rename()</code> function is designed to make this process easier.</p>
<p>Here you can see the names of the first six variables in the <code>starwars</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 6
  name                  height  mass hair_color skin_color       eye_color
  &lt;chr&gt;                  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;            &lt;chr&gt;    
1 Yoda                      66    17 white      green            brown    
2 Jabba Desilijic Tiure    175  1358 &lt;NA&gt;       green-tan, brown orange   
3 Chewbacca                228   112 brown      unknown          blue     </code></pre>
</div>
</div>
<p>Suppose we wanted to drop the <code>_color</code>. The syntax is <code>newname = oldname</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">rename</span>(starwars, <span class="at">hair =</span> hair_color, <span class="at">skin =</span> skin_color, <span class="at">eye =</span> eye_color)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 6
  name                  height  mass hair  skin             eye   
  &lt;chr&gt;                  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            &lt;chr&gt; 
1 Yoda                      66    17 white green            brown 
2 Jabba Desilijic Tiure    175  1358 &lt;NA&gt;  green-tan, brown orange
3 Chewbacca                228   112 brown unknown          blue  </code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Question
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you do the equivalent in base R without <code>dplyr</code>?</p>
</div>
</div>
</section>
<section id="adding-columns-with-mutate" class="level3">
<h3 class="anchored" data-anchor-id="adding-columns-with-mutate">Adding columns with <code>mutate()</code></h3>
<p>The <code>mutate()</code> function <strong>computes transformations of variables</strong> in a data frame.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/dplyr_mutate.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Artwork by Allison Horst on mutate() function</figcaption><p></p>
</figure>
</div>
<p>[<strong>Source</strong>: <a href="https://github.com/allisonhorst/stats-illustrations">Artwork by Allison Horst</a>]</p>
<p>For example, we may want to adjust height for mass:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">mutate</span>(starwars, <span class="at">heightsize =</span> height <span class="sc">/</span> mass )</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(starwars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 15
  name       height  mass hair  skin  eye   birth‚Ä¶¬π sex   gender homew‚Ä¶¬≤ species
  &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  
1 Yoda           66    17 white green brown     896 male  mascu‚Ä¶ &lt;NA&gt;    Yoda's‚Ä¶
2 Jabba Des‚Ä¶    175  1358 &lt;NA&gt;  gree‚Ä¶ oran‚Ä¶     600 herm‚Ä¶ mascu‚Ä¶ Nal Hu‚Ä¶ Hutt   
3 Chewbacca     228   112 brown unkn‚Ä¶ blue      200 male  mascu‚Ä¶ Kashyy‚Ä¶ Wookiee
4 C-3PO         167    75 &lt;NA&gt;  gold  yell‚Ä¶     112 none  mascu‚Ä¶ Tatooi‚Ä¶ Droid  
5 Dooku         193    80 white fair  brown     102 male  mascu‚Ä¶ Serenno Human  
6 Qui-Gon J‚Ä¶    193    89 brown fair  blue       92 male  mascu‚Ä¶ &lt;NA&gt;    Human  
# ‚Ä¶ with 4 more variables: films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,
#   heightsize &lt;dbl&gt;, and abbreviated variable names ¬π‚Äãbirth_year, ¬≤‚Äãhomeworld</code></pre>
</div>
</div>
<p>There is also the related <code>transmute()</code> function, which <code>mutate()</code>s and <em>keeps only the transformed variables</em>. Therefore, the result is only two columns in the transmuted data frame.</p>
</section>
<section id="perform-functions-on-groups-using-group_by" class="level3">
<h3 class="anchored" data-anchor-id="perform-functions-on-groups-using-group_by">Perform functions on groups using <code>group_by()</code></h3>
<p>The <code>group_by()</code> function is used to <strong>indicate groups within the data</strong>.</p>
<p>For example, what is the average height by homeworld?</p>
<p><strong>In conjunction</strong> with the <code>group_by()</code> function, we often use the <code>summarize()</code> function.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <strong>general operation</strong> here is a combination of</p>
<ol type="1">
<li>Splitting a data frame by group defined by a variable or group of variables (<code>group_by()</code>)</li>
<li><code>summarize()</code> across those subsets</li>
</ol>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can create a separate data frame that splits the original data frame by <code>homeworld</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>worlds <span class="ot">&lt;-</span> <span class="fu">group_by</span>(starwars, homeworld)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compute summary statistics by planet (just showing mean and median here, almost any summary stat is available):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(worlds, <span class="at">height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">maxheight =</span> <span class="fu">max</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">mass =</span> <span class="fu">median</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 49 √ó 4
   homeworld      height maxheight  mass
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 Alderaan         176.      176.  64  
 2 Aleen Minor       79        79   15  
 3 Bespin           175       175   79  
 4 Bestine IV       180       180  110  
 5 Cato Neimoidia   191       191   90  
 6 Cerea            198       198   82  
 7 Champala         196       196   NA  
 8 Chandrila        150       150   NA  
 9 Concord Dawn     183       183   79  
10 Corellia         175       175   78.5
# ‚Ä¶ with 39 more rows</code></pre>
</div>
</div>
</div>
</div>
<p><code>summarize()</code> returns a data frame with <code>homeworld</code> as the first column, followed by the requested summary statistics. This is similar to the base R function <code>aggregate()</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
More complicated example
</div>
</div>
<div class="callout-body-container callout-body">
<p>In a slightly more complicated example, we might want to know what are the average masses within quintiles of <code>height</code>:</p>
<p>First, we can create a categorical variable of <code>height5</code> divided into quintiles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>qq <span class="ot">&lt;-</span> <span class="fu">quantile</span>(starwars<span class="sc">$</span>height, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>starwars <span class="ot">&lt;-</span> <span class="fu">mutate</span>(starwars, <span class="at">height.quint =</span> <span class="fu">cut</span>(height, qq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can group the data frame by the <code>height.quint</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>quint <span class="ot">&lt;-</span> <span class="fu">group_by</span>(starwars, height.quint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can compute the mean of <code>mass</code> within quintiles of <code>height</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(quint, <span class="at">mquint =</span> <span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 2
  height.quint mquint
  &lt;fct&gt;         &lt;dbl&gt;
1 (66,165]       44.2
2 (165,175]     187. 
3 (175,183]      79.2
4 (183,193]      80.2
5 (193,264]     106. 
6 &lt;NA&gt;           17  </code></pre>
</div>
</div>
</div>
</div>
<p>Oddly enough there is a maximum mass in the second height quintile of Starwars characters. The biologist in me thinks maybe outliers?</p>
</section>
<section id="piping-multiple-functions-using" class="level3">
<h3 class="anchored" data-anchor-id="piping-multiple-functions-using">Piping multiple functions using <code>%&gt;%</code></h3>
<p>The pipe operator <code>%&gt;%</code> is very handy for <strong>stringing together multiple <code>dplyr</code> functions in a sequence of operations</strong>. It comes from the <strong>magritter</strong> package.</p>
<p><img src="https://s3-us-west-2.amazonaws.com/collections.lacma.org-images/remote_images/ma-150089-WEB.jpg?AIhOIuuCkaqUYKpVvGmkLe995PGXVHxg" class="img-fluid"> <a href="https://collections.lacma.org/node/239578">Source:</a></p>
<p>In base R, there are two styles of applying multiple functions. The first is the resave the object after each operation.</p>
<p>The second is to nest functions, with the first at the deepest level (the heart of the onion), then working our way out:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">third</span>(<span class="fu">second</span>(<span class="fu">first</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>%&gt;%</code> operator allows you to string operations in a left-to-right fashion, where the output of one flows into the next, i.e.:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(x) <span class="sc">%&gt;%</span> second <span class="sc">%&gt;%</span> third</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take the example that we just did in the last section.</p>
<p>That can be done with the following sequence:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(homeworld) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">maxheight =</span> <span class="fu">max</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">mass =</span> <span class="fu">median</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 49 √ó 4
   homeworld      height maxheight  mass
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 Alderaan         176.      176.  64  
 2 Aleen Minor       79        79   15  
 3 Bespin           175       175   79  
 4 Bestine IV       180       180  110  
 5 Cato Neimoidia   191       191   90  
 6 Cerea            198       198   82  
 7 Champala         196       196   NA  
 8 Chandrila        150       150   NA  
 9 Concord Dawn     183       183   79  
10 Corellia         175       175   78.5
# ‚Ä¶ with 39 more rows</code></pre>
</div>
</div>
</div>
</div>
<section id="data-masking" class="level4">
<h4 class="anchored" data-anchor-id="data-masking">Data masking</h4>
<p>Notice that we did not have to specify the dataframe. This is because dplyr functions are built on a data masking syntax. From the dplyr data-masking help page:</p>
<blockquote class="blockquote">
<p>Data masking allows you to refer to variables in the ‚Äúcurrent‚Äù data frame (usually supplied in the .data argument), without any other prefix. It‚Äôs what allows you to type (e.g.) <code>filter(diamonds, x == 0 &amp; y == 0 &amp; z == 0)</code> instead of <code>diamonds[diamonds$x == 0 &amp; diamonds$y == 0 &amp; diamonds$z == 0, ]</code></p>
</blockquote>
<p>When you look at the help page for <code>?mutate</code> for example, you will see a function definition like so:</p>
<blockquote class="blockquote">
<p><code>mutate(.data, ...)</code></p>
</blockquote>
<p>Note the <code>.data</code>, Which means that the data can be supplied as usual, or it can be inherited from the ‚Äúcurrent‚Äù data frame which is passed to it via a pipe.</p>
</section>
</section>
<section id="sample-rows-of-data-with-slice_" class="level3">
<h3 class="anchored" data-anchor-id="sample-rows-of-data-with-slice_">Sample rows of data with <code>slice_*()</code></h3>
<p>The <code>slice_sample()</code> function will <strong>randomly sample rows</strong> of data.</p>
<p>The number of rows to show is specified by the <code>n</code> argument.</p>
<ul>
<li>This can be useful if you <strong>do not want to print the entire tibble</strong>, but you want to get a greater sense of the variation.</li>
</ul>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Example
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>(starwars, <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 16
   name      height  mass hair  skin  eye   birth‚Ä¶¬π sex   gender homew‚Ä¶¬≤ species
   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  
 1 Jek Tono‚Ä¶    180 110   brown fair  blue       NA male  mascu‚Ä¶ Bestin‚Ä¶ Human  
 2 Ric Oli√©     183  NA   brown fair  blue       NA &lt;NA&gt;  &lt;NA&gt;   Naboo   &lt;NA&gt;   
 3 Poggle t‚Ä¶    183  80   none  green yell‚Ä¶      NA male  mascu‚Ä¶ Geonos‚Ä¶ Geonos‚Ä¶
 4 Luminara‚Ä¶    170  56.2 black yell‚Ä¶ blue       58 fema‚Ä¶ femin‚Ä¶ Mirial  Mirial‚Ä¶
 5 Lama Su      229  88   none  grey  black      NA male  mascu‚Ä¶ Kamino  Kamino‚Ä¶
 6 Nien Nunb    160  68   none  grey  black      NA male  mascu‚Ä¶ Sullust Sullus‚Ä¶
 7 Jango Fe‚Ä¶    183  79   black tan   brown      66 male  mascu‚Ä¶ Concor‚Ä¶ Human  
 8 Gregar T‚Ä¶    185  85   black dark  brown      NA male  mascu‚Ä¶ Naboo   Human  
 9 Roos Tar‚Ä¶    224  82   none  grey  oran‚Ä¶      NA male  mascu‚Ä¶ Naboo   Gungan 
10 Ben Quad‚Ä¶    163  65   none  grey‚Ä¶ oran‚Ä¶      NA male  mascu‚Ä¶ Tund    Toong  
# ‚Ä¶ with 5 more variables: films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,
#   heightsize &lt;dbl&gt;, height.quint &lt;fct&gt;, and abbreviated variable names
#   ¬π‚Äãbirth_year, ¬≤‚Äãhomeworld</code></pre>
</div>
</div>
</div>
</div>
<p>You can also use <code>slice_head()</code> or <code>slice_tail()</code> to take a look at the top rows or bottom rows of your tibble. Again the number of rows can be specified with the <code>n</code> argument.</p>
<p>This will show the first 5 rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_head</span>(starwars, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 16
  name       height  mass hair  skin  eye   birth‚Ä¶¬π sex   gender homew‚Ä¶¬≤ species
  &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  
1 Yoda           66    17 white green brown     896 male  mascu‚Ä¶ &lt;NA&gt;    Yoda's‚Ä¶
2 Jabba Des‚Ä¶    175  1358 &lt;NA&gt;  gree‚Ä¶ oran‚Ä¶     600 herm‚Ä¶ mascu‚Ä¶ Nal Hu‚Ä¶ Hutt   
3 Chewbacca     228   112 brown unkn‚Ä¶ blue      200 male  mascu‚Ä¶ Kashyy‚Ä¶ Wookiee
4 C-3PO         167    75 &lt;NA&gt;  gold  yell‚Ä¶     112 none  mascu‚Ä¶ Tatooi‚Ä¶ Droid  
5 Dooku         193    80 white fair  brown     102 male  mascu‚Ä¶ Serenno Human  
# ‚Ä¶ with 5 more variables: films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,
#   heightsize &lt;dbl&gt;, height.quint &lt;fct&gt;, and abbreviated variable names
#   ¬π‚Äãbirth_year, ¬≤‚Äãhomeworld</code></pre>
</div>
</div>
<p>This will show the last 5 rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_tail</span>(starwars, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 16
  name       height  mass hair  skin  eye   birth‚Ä¶¬π sex   gender homew‚Ä¶¬≤ species
  &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  
1 Finn           NA    NA black dark  dark       NA male  mascu‚Ä¶ &lt;NA&gt;    Human  
2 Rey            NA    NA brown light hazel      NA fema‚Ä¶ femin‚Ä¶ &lt;NA&gt;    Human  
3 Poe Damer‚Ä¶     NA    NA brown light brown      NA male  mascu‚Ä¶ &lt;NA&gt;    Human  
4 BB8            NA    NA none  none  black      NA none  mascu‚Ä¶ &lt;NA&gt;    Droid  
5 Captain P‚Ä¶     NA    NA unkn‚Ä¶ unkn‚Ä¶ unkn‚Ä¶      NA &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;   
# ‚Ä¶ with 5 more variables: films &lt;list&gt;, vehicles &lt;list&gt;, starships &lt;list&gt;,
#   heightsize &lt;dbl&gt;, height.quint &lt;fct&gt;, and abbreviated variable names
#   ¬π‚Äãbirth_year, ¬≤‚Äãhomeworld</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>The <code>dplyr</code> package provides an alternative syntax for manipulating data frames. In particular, we can often conduct the beginnings of an exploratory analysis with the powerful combination of <code>group_by()</code> and <code>summarize()</code>.</p>
<p>Once you learn the <code>dplyr</code> grammar there are a few additional benefits</p>
<ul>
<li><p><code>dplyr</code> can work with other data frame ‚Äúback ends‚Äù such as SQL databases. There is an SQL interface for relational databases via the DBI package</p></li>
<li><p><code>dplyr</code> can be integrated with the <code>data.table</code> package for large fast tables</p></li>
<li><p>Many people like the piping syntax for readability and clarity</p></li>
</ul>
</section>
<section id="post-lecture-materials" class="level1">
<h1>Post-lecture materials</h1>
<section id="final-questions" class="level3">
<h3 class="anchored" data-anchor-id="final-questions">Final Questions</h3>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Questions
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>How can you tell if an object is a tibble?</li>
<li>Using the <code>trees</code> dataset in base R (this dataset stores the girth, height, and volume for Black Cherry Trees) and using the pipe operator:
<ol type="i">
<li>convert the <code>data.frame</code> to a tibble.</li>
<li>filter for rows with a tree height of greater than 70, and</li>
<li>order rows by <code>Volume</code> (smallest to largest).</li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(trees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Girth Height Volume
1   8.3     70   10.3
2   8.6     65   10.3
3   8.8     63   10.2
4  10.5     72   16.4
5  10.7     81   18.8
6  10.8     83   19.7</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="additional-resources" class="level3">
<h3 class="anchored" data-anchor-id="additional-resources">Additional Resources</h3>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://jhudatascience.org/tidyversecourse/wrangle-data.html#data-wrangling" class="uri">https://jhudatascience.org/tidyversecourse/wrangle-data.html#data-wrangling</a></li>
<li><a href="http://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">dplyr cheat sheet from RStudio</a></li>
</ul>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>