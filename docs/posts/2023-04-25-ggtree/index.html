<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.333">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marguerite Butler">
<meta name="dcterms.date" content="2023-04-25">
<meta name="description" content="Working with trees with tidytree and plotting with ggtree">

<title>ZOOL710 Data Science in R for Biologists - The ggtree-verse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ZOOL710 Data Science in R for Biologists</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-general-information" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">General Information</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-general-information">    
        <li>
    <a class="dropdown-item" href="../../syllabus.html" rel="" target="">
 <span class="dropdown-text">Syllabus</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../schedule.html" rel="" target="">
 <span class="dropdown-text">Schedule</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-course-materials" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Course Materials</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-course-materials">    
        <li>
    <a class="dropdown-item" href="../../lectures.html" rel="" target="">
 <span class="dropdown-text">Lectures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../projects.html" rel="" target="">
 <span class="dropdown-text">Projects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources.html" rel="" target="">
 <span class="dropdown-text">Resources</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml" rel="" target=""><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The ggtree-verse</h1>
                  <div>
        <div class="description">
          Working with trees with tidytree and plotting with ggtree
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">module 7</div>
                <div class="quarto-category">week 13</div>
                <div class="quarto-category">phylogenetic trees</div>
                <div class="quarto-category">phylo</div>
                <div class="quarto-category">ggtree</div>
                <div class="quarto-category">treedata</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://butlerlab.org">Marguerite Butler</a> </p>
    </div>
      <div class="quarto-title-meta-contents">
          <p class="affiliation">
              School of Life Sciences, University of Hawaii
            </p>
        </div>
      </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 25, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link active" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#phylo---treedata" id="toc-phylo---treedata" class="nav-link" data-scroll-target="#phylo---treedata">phylo -&gt; treedata</a>
  <ul class="collapse">
  <li><a href="#coverting-between-data-types" id="toc-coverting-between-data-types" class="nav-link" data-scroll-target="#coverting-between-data-types">Coverting between data types</a></li>
  </ul></li>
  <li><a href="#simulate-phenotypic-data" id="toc-simulate-phenotypic-data" class="nav-link" data-scroll-target="#simulate-phenotypic-data">Simulate phenotypic data</a>
  <ul class="collapse">
  <li><a href="#add-tiplabels" id="toc-add-tiplabels" class="nav-link" data-scroll-target="#add-tiplabels">Add tiplabels</a></li>
  <li><a href="#get-the-tip-labels" id="toc-get-the-tip-labels" class="nav-link" data-scroll-target="#get-the-tip-labels">Get the tip labels</a></li>
  </ul></li>
  <li><a href="#merge-tree-with-data" id="toc-merge-tree-with-data" class="nav-link" data-scroll-target="#merge-tree-with-data">Merge tree with data</a>
  <ul class="collapse">
  <li><a href="#subsetting-the-tree" id="toc-subsetting-the-tree" class="nav-link" data-scroll-target="#subsetting-the-tree">Subsetting the tree</a></li>
  <li><a href="#plotting-with-node-labels" id="toc-plotting-with-node-labels" class="nav-link" data-scroll-target="#plotting-with-node-labels">Plotting with node labels</a></li>
  <li><a href="#plotting-with-alternative-tip-labels" id="toc-plotting-with-alternative-tip-labels" class="nav-link" data-scroll-target="#plotting-with-alternative-tip-labels">Plotting with alternative tip labels</a></li>
  <li><a href="#when-your-tip-labels-get-cut-off" id="toc-when-your-tip-labels-get-cut-off" class="nav-link" data-scroll-target="#when-your-tip-labels-get-cut-off">When your tip labels get cut off</a></li>
  </ul></li>
  <li><a href="#tree-layouts" id="toc-tree-layouts" class="nav-link" data-scroll-target="#tree-layouts">Tree layouts</a></li>
  <li><a href="#plotting-data-on-the-tree" id="toc-plotting-data-on-the-tree" class="nav-link" data-scroll-target="#plotting-data-on-the-tree">Plotting data on the tree</a></li>
  <li><a href="#example-datasets" id="toc-example-datasets" class="nav-link" data-scroll-target="#example-datasets">Example datasets</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="acknowledgements" class="level3">
<h3 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>References for this Material:</p>
<ul>
<li>Treedata book by Guangchuang Yu <a href="https://yulab-smu.top/treedata-book/" class="uri">https://yulab-smu.top/treedata-book/</a></li>
<li><a href="https://bioconnector.github.io/workshops/r-ggtree.html" class="uri">https://bioconnector.github.io/workshops/r-ggtree.html</a></li>
</ul>
</section>
<section id="learning-objectives" class="level1">
<h1>Learning objectives</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>At the end of this lesson you will:</strong></p>
<ul>
<li>Understand information content of phylogenetically structured data</li>
<li>Understand particular R tree formats in ape, phylobase, and ouch</li>
<li>Be able to hand-make trees</li>
<li>Be able to import trees from nexus, newick, and other major formats in use today</li>
<li>Be able to convert trees from one format to another</li>
<li>Be able to perform basic tree manipulations</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
R packages you will need
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><code>ape</code></li>
<li><code>ggtree</code></li>
<li><code>tidytree</code></li>
<li><code>treeio</code></li>
</ul>
</div>
</div>
</section>
<section id="overview" class="level1">
<h1>Overview</h1>
<p><code>ggtree</code> is a powerful phylogenetic tree plotting package, that is used alongside <code>treeio</code> and <code>tidytree</code> packages to import/export and to manipulate phylogenetic trees, respectively. These packages allow you to subset or combine trees with data, annotate, and plot in so many different ways using the grammar of graphics.</p>
<p>Because itʻs written in the style of <code>ggplot2</code> and the <code>tidyverse</code>, there are a lot of functions to remember, and now there are also multiple object types. The key to working effectively with <code>ggtree</code> is to be aware of what type of object you are working with, whether it is a <code>dataframe</code>, a <code>tibble</code>, a <code>phylo</code> tree, a <code>treedata</code> tibble, or <code>ggtree</code> object. It is easy to convert between these at will if you know what you are dealing with.</p>
</section>
<section id="phylo---treedata" class="level1">
<h1>phylo -&gt; treedata</h1>
<p>Functions like <code>read.tree</code> amd <code>read.nexus</code>, etc. will read in objects of class <code>phylo</code> (they are actually referencing the ape function).</p>
<p>To show this, letʻs first generate a random tree using <code>ape::rtree()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ape)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggtree)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(treeio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">rtree</span>(<span class="dv">20</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "phylo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree)  <span class="co"># ape plotting function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note: <code>ggtree</code> can also accept <code>phylo</code> objects as arguments:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(tree)  <span class="co"># ggtree plotting function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To save as newick and nexus formats, <code>treeio</code> has the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>treeio<span class="sc">::</span><span class="fu">write.nexus</span>(tree, <span class="at">file=</span><span class="st">"tree.nex"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>treeio<span class="sc">::</span><span class="fu">write.tree</span>(tree, <span class="at">file=</span><span class="st">"tree.tree"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "anolis.SSD.raw.csv" "bigtree.nex"        "ggtree_functions.R"
 [4] "ggtree.R"           "index_files"        "index.qmd"         
 [7] "index.rmarkdown"    "mytree.tree"        "rnw2qmd.R"         
[10] "tree.nex"           "tree.tree"         </code></pre>
</div>
</div>
<p>Take a look at these files. They should be in nexus and newick formats, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tree_nex <span class="ot">&lt;-</span> treeio<span class="sc">::</span><span class="fu">read.nexus</span>(<span class="at">file=</span><span class="st">"tree.nex"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>tree_new <span class="ot">&lt;-</span> treeio<span class="sc">::</span><span class="fu">read.newick</span>(<span class="at">file=</span><span class="st">"tree.tree"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tree_nex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "phylo"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(tree_new)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "phylo"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have trees from <code>iqtree</code>, <code>BEAST</code> etc., you should use the specialized read functions because they will capture the metadata embedded in the treeformat including support values.</p>
</div>
</div>
<section id="coverting-between-data-types" class="level2">
<h2 class="anchored" data-anchor-id="coverting-between-data-types">Coverting between data types</h2>
<p>The main functions for coersion are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.phylo</span> (tree)  <span class="co"># to phylo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Phylogenetic tree with 20 tips and 19 internal nodes.

Tip labels:
  t11, t9, t10, t2, t6, t5, ...

Rooted; includes branch lengths.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.treedata</span>(tree) <span class="co"># to treedata</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'treedata' S4 object'.

...@ phylo:

Phylogenetic tree with 20 tips and 19 internal nodes.

Tip labels:
  t11, t9, t10, t2, t6, t5, ...

Rooted; includes branch lengths.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>treedata <span class="ot">&lt;-</span> <span class="fu">as.treedata</span>(tree)  </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(treedata)  <span class="co"># to tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 39 × 4
   parent  node branch.length label
    &lt;int&gt; &lt;int&gt;         &lt;dbl&gt; &lt;chr&gt;
 1     22     1        0.279  t11  
 2     22     2        0.127  t9   
 3     26     3        0.300  t10  
 4     27     4        0.435  t2   
 5     27     5        0.553  t6   
 6     28     6        0.764  t5   
 7     28     7        0.499  t1   
 8     30     8        0.0345 t7   
 9     30     9        0.787  t16  
10     33    10        0.871  t20  
# … with 29 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="simulate-phenotypic-data" class="level1">
<h1>Simulate phenotypic data</h1>
<section id="add-tiplabels" class="level3">
<h3 class="anchored" data-anchor-id="add-tiplabels">Add tiplabels</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(tree) <span class="sc">+</span> <span class="fu">geom_tiplab</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="get-the-tip-labels" class="level3">
<h3 class="anchored" data-anchor-id="get-the-tip-labels">Get the tip labels</h3>
<p>There is a function <code>get_taxa_name()</code> which is very handy, but NOTE: its argument is a <code>ggtree</code> object, not a <code>treedata</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(tree) <span class="sc">+</span> <span class="fu">geom_tiplab</span>()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_taxa_name</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "t19" "t20" "t15" "t13" "t16" "t7"  "t6"  "t2"  "t10" "t1"  "t5"  "t4" 
[13] "t17" "t14" "t3"  "t12" "t18" "t8"  "t9"  "t11"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>taxa <span class="ot">&lt;-</span> <span class="fu">get_taxa_name</span>(p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Simulate a data matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(taxa)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean=</span><span class="dv">20</span>, <span class="at">sd=</span><span class="dv">5</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>habitat <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"desert"</span>, <span class="st">"grassland"</span>, <span class="st">"forest"</span>, <span class="st">"intertidal"</span>), <span class="at">size=</span>n, <span class="at">replace=</span>T)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="st">"label"</span><span class="ot">=</span> taxa, size, habitat)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   label      size    habitat
1    t19 18.925902  grassland
2    t20 23.708948     forest
3    t15 17.667552     forest
4    t13 26.492428 intertidal
5    t16 23.094844     forest
6     t7 28.153165     desert
7     t6 27.525594     forest
8     t2 18.492712  grassland
9    t10 24.009872     forest
10    t1 16.825641  grassland
11    t5 24.801745     forest
12    t4  8.793568     forest
13   t17 17.280791     desert
14   t14 22.973981     desert
15    t3 25.381193 intertidal
16   t12 23.971733  grassland
17   t18 14.399356  grassland
18    t8 17.719463     forest
19    t9 18.044723 intertidal
20   t11 16.778249  grassland</code></pre>
</div>
</div>
<p>See our ggtree as a treedata object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.treedata</span>(p) <span class="sc">%&gt;%</span> as_tibble <span class="sc">%&gt;%</span> as.data.frame  <span class="co"># ggtree -&gt; treedata -&gt; tibble -&gt; dataframe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   parent node branch.length label
1      22    1   0.278939538   t11
2      22    2   0.127345336    t9
3      26    3   0.300447684   t10
4      27    4   0.435377757    t2
5      27    5   0.552980925    t6
6      28    6   0.764464183    t5
7      28    7   0.499308378    t1
8      30    8   0.034501367    t7
9      30    9   0.787341947   t16
10     33   10   0.870559227   t20
11     33   11   0.813121315   t19
12     32   12   0.177632412   t15
13     31   13   0.715450910   t13
14     36   14   0.197539931    t3
15     38   15   0.214468429   t17
16     38   16   0.751333333    t4
17     37   17   0.581087446   t14
18     39   18   0.183712207   t18
19     39   19   0.798547462   t12
20     34   20   0.688117656    t8
21     21   21            NA  &lt;NA&gt;
22     21   22   0.412084444  &lt;NA&gt;
23     21   23   0.991313945  &lt;NA&gt;
24     23   24   0.847770900  &lt;NA&gt;
25     24   25   0.128256809  &lt;NA&gt;
26     25   26   0.611658429  &lt;NA&gt;
27     26   27   0.721636676  &lt;NA&gt;
28     25   28   0.355111233  &lt;NA&gt;
29     24   29   0.010121288  &lt;NA&gt;
30     29   30   0.344141605  &lt;NA&gt;
31     29   31   0.316786686  &lt;NA&gt;
32     31   32   0.058795683  &lt;NA&gt;
33     32   33   0.032994980  &lt;NA&gt;
34     23   34   0.798382514  &lt;NA&gt;
35     34   35   0.007182305  &lt;NA&gt;
36     35   36   0.930358109  &lt;NA&gt;
37     36   37   0.984382103  &lt;NA&gt;
38     37   38   0.277136115  &lt;NA&gt;
39     35   39   0.942967743  &lt;NA&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="merge-tree-with-data" class="level1">
<h1>Merge tree with data</h1>
<p>Now that we have a matching key in both the tree and data objects, we can join the tree with the dataframe by those matching labels using <code>ggtree</code>ʻs <code>full_join</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ttree <span class="ot">&lt;-</span> <span class="fu">full_join</span>(tree, dat, <span class="at">by =</span> <span class="st">"label"</span>) </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ttree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'treedata' S4 object'.

...@ phylo:

Phylogenetic tree with 20 tips and 19 internal nodes.

Tip labels:
  t11, t9, t10, t2, t6, t5, ...

Rooted; includes branch lengths.

with the following features available:
  'size', 'habitat'.

# The associated data tibble abstraction: 39 × 5
# The 'node', 'label' and 'isTip' are from the phylo tree.
    node label isTip  size habitat   
   &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;     
 1     1 t11   TRUE   16.8 grassland 
 2     2 t9    TRUE   18.0 intertidal
 3     3 t10   TRUE   24.0 forest    
 4     4 t2    TRUE   18.5 grassland 
 5     5 t6    TRUE   27.5 forest    
 6     6 t5    TRUE   24.8 forest    
 7     7 t1    TRUE   16.8 grassland 
 8     8 t7    TRUE   28.2 desert    
 9     9 t16   TRUE   23.1 forest    
10    10 t20   TRUE   23.7 forest    
# … with 29 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ttree <span class="sc">%&gt;%</span> as_tibble <span class="sc">%&gt;%</span> as.data.frame</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   parent node branch.length label      size    habitat
1      22    1   0.278939538   t11 16.778249  grassland
2      22    2   0.127345336    t9 18.044723 intertidal
3      26    3   0.300447684   t10 24.009872     forest
4      27    4   0.435377757    t2 18.492712  grassland
5      27    5   0.552980925    t6 27.525594     forest
6      28    6   0.764464183    t5 24.801745     forest
7      28    7   0.499308378    t1 16.825641  grassland
8      30    8   0.034501367    t7 28.153165     desert
9      30    9   0.787341947   t16 23.094844     forest
10     33   10   0.870559227   t20 23.708948     forest
11     33   11   0.813121315   t19 18.925902  grassland
12     32   12   0.177632412   t15 17.667552     forest
13     31   13   0.715450910   t13 26.492428 intertidal
14     36   14   0.197539931    t3 25.381193 intertidal
15     38   15   0.214468429   t17 17.280791     desert
16     38   16   0.751333333    t4  8.793568     forest
17     37   17   0.581087446   t14 22.973981     desert
18     39   18   0.183712207   t18 14.399356  grassland
19     39   19   0.798547462   t12 23.971733  grassland
20     34   20   0.688117656    t8 17.719463     forest
21     21   21            NA  &lt;NA&gt;        NA       &lt;NA&gt;
22     21   22   0.412084444  &lt;NA&gt;        NA       &lt;NA&gt;
23     21   23   0.991313945  &lt;NA&gt;        NA       &lt;NA&gt;
24     23   24   0.847770900  &lt;NA&gt;        NA       &lt;NA&gt;
25     24   25   0.128256809  &lt;NA&gt;        NA       &lt;NA&gt;
26     25   26   0.611658429  &lt;NA&gt;        NA       &lt;NA&gt;
27     26   27   0.721636676  &lt;NA&gt;        NA       &lt;NA&gt;
28     25   28   0.355111233  &lt;NA&gt;        NA       &lt;NA&gt;
29     24   29   0.010121288  &lt;NA&gt;        NA       &lt;NA&gt;
30     29   30   0.344141605  &lt;NA&gt;        NA       &lt;NA&gt;
31     29   31   0.316786686  &lt;NA&gt;        NA       &lt;NA&gt;
32     31   32   0.058795683  &lt;NA&gt;        NA       &lt;NA&gt;
33     32   33   0.032994980  &lt;NA&gt;        NA       &lt;NA&gt;
34     23   34   0.798382514  &lt;NA&gt;        NA       &lt;NA&gt;
35     34   35   0.007182305  &lt;NA&gt;        NA       &lt;NA&gt;
36     35   36   0.930358109  &lt;NA&gt;        NA       &lt;NA&gt;
37     36   37   0.984382103  &lt;NA&gt;        NA       &lt;NA&gt;
38     37   38   0.277136115  &lt;NA&gt;        NA       &lt;NA&gt;
39     35   39   0.942967743  &lt;NA&gt;        NA       &lt;NA&gt;</code></pre>
</div>
</div>
<p>And thatʻs what our <code>treedata</code> object looks like flattened out!</p>
<section id="subsetting-the-tree" class="level2">
<h2 class="anchored" data-anchor-id="subsetting-the-tree">Subsetting the tree</h2>
<p>Functions: <code>drop.tip()</code> and <code>keep.tip()</code></p>
<p>Suppose we want to drop all of the even tips:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>todrop <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"t"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">2</span>, <span class="at">sep=</span><span class="st">""</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>todrop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "t2"  "t4"  "t6"  "t8"  "t10" "t12" "t14" "t16" "t18" "t20"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>smalltree <span class="ot">&lt;-</span> <span class="fu">drop.tip</span>(ttree, todrop)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>smalltree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'treedata' S4 object'.

...@ phylo:

Phylogenetic tree with 10 tips and 9 internal nodes.

Tip labels:
  t11, t9, t5, t1, t7, t19, ...

Rooted; includes branch lengths.

with the following features available:
  'size', 'habitat'.

# The associated data tibble abstraction: 19 × 5
# The 'node', 'label' and 'isTip' are from the phylo tree.
    node label isTip  size habitat   
   &lt;int&gt; &lt;chr&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;chr&gt;     
 1     1 t11   TRUE   16.8 grassland 
 2     2 t9    TRUE   18.0 intertidal
 3     3 t5    TRUE   24.8 forest    
 4     4 t1    TRUE   16.8 grassland 
 5     5 t7    TRUE   28.2 desert    
 6     6 t19   TRUE   18.9 grassland 
 7     7 t15   TRUE   17.7 forest    
 8     8 t13   TRUE   26.5 intertidal
 9     9 t3    TRUE   25.4 intertidal
10    10 t17   TRUE   17.3 desert    
# … with 9 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> <span class="fu">geom_tiplab</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code>drop.tip</code> keeps all of the metadata! <code>keep.tip</code> is imported from <code>ape</code> so it has to be converted to <code>phylo</code> and then the data joined again after.</p>
</section>
<section id="plotting-with-node-labels" class="level2">
<h2 class="anchored" data-anchor-id="plotting-with-node-labels">Plotting with node labels</h2>
<p>The geometries <code>geom_text()</code> and <code>geom_node()</code> are helpful for labelling all of the nodes. The function <code>geom_tiplab()</code> labels only the tips.</p>
<p>Add node labels so you know what the internal node numbers are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>node), <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">3</span>)    <span class="co"># node numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note: The tiplabels and the node labels crashed!</p>
<p>There are also <code>2</code> versions: <code>geom_text2()</code> and <code>geom_node2()</code> that allow subsetting the nodes, when you want the geometry to apply to only some of the nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>() <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text2</span>(<span class="fu">aes</span>(<span class="at">label=</span>node, <span class="at">subset=</span><span class="sc">!</span>isTip), <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">3</span>)    <span class="co"># node numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code>isTip</code> is a column of the ggtree object, so it is inherited when we provide the ggtree object.</p>
</section>
<section id="plotting-with-alternative-tip-labels" class="level2">
<h2 class="anchored" data-anchor-id="plotting-with-alternative-tip-labels">Plotting with alternative tip labels</h2>
<p>The dataframe portion of the treedata object can hold any number of columns of metadata. Perhaps you have some real names in a different column (like a display name), it is easy to swap out the tip labels. Here letʻs just use the <code>habitat</code> column</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">label=</span>habitat)) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text2</span>(<span class="fu">aes</span>(<span class="at">label=</span>node, <span class="at">subset=</span><span class="sc">!</span>isTip), <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">3</span>)    <span class="co"># node numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="when-your-tip-labels-get-cut-off" class="level2">
<h2 class="anchored" data-anchor-id="when-your-tip-labels-get-cut-off">When your tip labels get cut off</h2>
<p>Add an x scale (usually time):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">label=</span>habitat)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text2</span>(<span class="fu">aes</span>(<span class="at">label=</span>node, <span class="at">subset=</span><span class="sc">!</span>isTip), <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">3</span>) <span class="sc">+</span>   <span class="co"># node numbers</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_tree2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can increase the size of the plot area to accommodate the longer labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">label=</span>habitat)) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text2</span>(<span class="fu">aes</span>(<span class="at">label=</span>node, <span class="at">subset=</span><span class="sc">!</span>isTip), <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">3</span>) <span class="sc">+</span>   <span class="co"># node numbers</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_tree2</span>() <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="tree-layouts" class="level1">
<h1>Tree layouts</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(cowplot)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"roundrect"</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"slanted"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"ellipse"</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"circular"</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"fan"</span>, <span class="at">open.angle=</span><span class="dv">120</span>),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"equal_angle"</span>),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"daylight"</span>),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">branch.length=</span><span class="st">'none'</span>),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"ellipse"</span>, <span class="at">branch.length=</span><span class="st">"none"</span>),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">branch.length=</span><span class="st">'none'</span>, <span class="at">layout=</span><span class="st">'circular'</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(ttree, <span class="at">layout=</span><span class="st">"daylight"</span>, <span class="at">branch.length =</span> <span class="st">'none'</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="plotting-data-on-the-tree" class="level1">
<h1>Plotting data on the tree</h1>
<p>NEED TO WORK ON THIS A BIT MORE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>smdat <span class="ot">&lt;-</span> smalltree <span class="sc">%&gt;%</span> as_tibble </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(smalltree) <span class="sc">+</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">label=</span>habitat)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text2</span>(<span class="fu">aes</span>(<span class="at">label=</span>node, <span class="at">subset=</span><span class="sc">!</span>isTip), <span class="at">hjust=</span><span class="sc">-</span>.<span class="dv">3</span>) <span class="sc">+</span>   <span class="co"># node numbers</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_tree2</span>() <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_facet</span>(<span class="at">panel =</span> <span class="st">"Size"</span>, <span class="at">data=</span>smdat, <span class="at">geom =</span> geom_col, </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> size), <span class="at">orientation =</span> <span class="st">'y'</span>, <span class="at">width =</span> .<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-datasets" class="level1">
<h1>Example datasets</h1>
<p>save to your working directory:</p>
<p><a href="bigtree.nex">bigtree.nex</a> <a href="anolis.SSD.raw.csv">anolis.SSD.raw.csv</a> <a href="ggtree.R">ggtree.R</a></p>
<p>This is an example of a typical workflow. We have carefully collected phenotypic data, and someone has published a massive phylogeny. We need to subset the tree to just the taxa we want to work on.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>