---
title: "Literate Statistical Programming and Quarto"
author:
  - name: Marguerite Butler
    url: https://butlerlab.org
    affiliation: School of Life Sciences, University of Hawaii
    affiliation_url: https://manoa.hawaii.edu/lifesciences/
description: "Introduction to literate statistical programming tools including  Quarto Markdown"
date: 2023-01-26
categories: [module 1, week 2, Markdown, Quarto, programming]
bibliography: my-refs.bib
---

<!-- Add interesting quote -->

# Pre-lecture materials

### Read ahead

::: callout-note
### Read ahead

**Before class, you can prepare by reading the following materials:**

1.  <https://rss.onlinelibrary.wiley.com/doi/epdf/10.1111/1740-9713.01522>
2.  Creating a Website in Quarto quickstart *up to and including Render* <https://quarto.org/docs/websites/>
3.  Publishing to GitHub *up to and including Render to docs* <https://quarto.org/docs/publishing/github-pages.html>
:::

### Acknowledgements

Material for this lecture was borrowed and adopted from

-   <https://www.stephaniehicks.com/jhustatcomputing2022/posts/2022-09-01-literate-programming/>
-   <http://users.stat.umn.edu/~geyer/Sweave/>
-   <https://rdpeng.github.io/Biostat776/lecture-literate-statistical-programming.html>
-   <https://statsandr.com/blog/tips-and-tricks-in-rstudio-and-r-markdown>

# Learning objectives

::: callout-note
# Learning objectives

**At the end of this lesson you will:**

-   Be able to define literate programming
-   Know how to use R plus a text editor or Rstudio to practice literate programming
-   Create a Quarto markdown document
:::

# Literate Programming

Before there was widespread concern about "Reproducible Research", the term **literate programming** was coined by [Donald Knuth](https://www-cs-faculty.stanford.edu/~knuth/), one of the true geniuses of computing, the author/inventor of TeX, and the notion of structured programming,  among other things. He wrote a book about it in 1984!

> Literate programming is a methodology that combines a programming language with a documentation language, thereby making programs more robust, more portable, more easily maintained, and arguably more fun to write than programs that are written only in a high-level language.

> The main idea is to treat a program as a piece of literature, *addressed to human beings rather than to a computer*. The program is also viewed as a hypertext document, rather like the World Wide Web. (Indeed, I used the word WEB for this purpose long before CERN grabbed it!) ---*Donald Knuth*

The basic idea is that:

- Programs are useless without descriptions.
- Descriptions should be literate, not comments in code or typical reference manuals.
- The *code* in the descriptions *should work*. Thus it is necessary to extract the real working code from the literary description.

These concepts were baked into the R help pages. You will see that there are working code examples for every single function in R at the bottom of each help page. In fact it is required before a package will be published on CRAN.

::: callout-tip
### Additional Reading
- Knuthʻs Webpage about his [book on Literate Programming](https://www-cs-faculty.stanford.edu/~knuth/lp.html)
:::


# The Data Science Pipeline

The basic issue is when you read a description of a data analysis, such as in an article or a technical report, for the most part, what you get is the report and nothing else.

Of course, everyone knows that behind the scenes **there's a lot that went into this article** and that is what I call the **data science pipeline**.

![The Data Science Pipeline](../../images/dspipeline.png)



# Literate Programming in Practice

One basic idea to make writing reproducible reports easier is what's known as *literate statistical programming*. The idea is to **think of a report or a publication as a stream of text and code**.

- The text is readable by people and the code is readable by computers.
- The analysis is described in a series of text and code chunks.

- Each kind of code chunk will do something like load some data or compute some results.
- Each text chunk will relay something in a human readable language.

- **The code and text remain together** in a single source document. No more separate analysis files and word processing files. When code is edited, the report is automatically generated and updated.

There might also be **presentation code** that formats tables and figures and there's article text that explains what's going on around all this code. This stream of text and code is a literate statistical program or a literate statistical analysis.

### Weaving and Tangling

Literate programs by themselves are a bit difficult to work with, but they can be processed in two important ways.

Literate programs can be **weaved** to produce human readable documents like PDFs or HTML web pages, and they can **tangled** to produce machine-readable "documents", or in other words, machine readable code.

In order to use a system like this you need a documentational language, that's human readable, and you need a programming language that's machine readable (or can be compiled/interpreted into something that's machine readable).

### Sweave

One of the original literate programming systems in R that was designed to do this was called Sweave written by [Friedrich Leisch](https://documents.uow.edu.au/content/groups/public/@web/@commerce/documents/doc/uow012868.pdf). Sweave enables users to combine R code with a documentation program called LaTeX.  Sweave revolutionized coding, and has become part of the R base code. Leisch is on the R Core Development Team and the BioConductor Project.

**Sweave files ends a `.Rnw`** and have R code weaved through the document:

    <<plot1, height=4, width=5, eval=FALSE>>=
    data(airquality)
    plot(airquality$Ozone ~ airquality$Wind)
    @

Once you have created your `.Rnw` file, Sweave will process the file, executing the R chunks and replacing them with output as appropriate before creating the PDF document.

Sweaveʻs main limitation is that it requires knowledge of LaTeX

- LaTeX is very powerful for laying out mathematical equations and fine-tuned control of formatting, but is not a documentation language that is widely used outside of mathematics.
- Therefore, there is a steep learning curve.
- Sweave also **lacks a lot of features that people find useful** like caching, and multiple plots per page and mixing programming languages.

Instead, folks have moved towards using something called **knitr**, which offers everything Sweave does, plus it extends it to much simpler Markdown documents.

### rmarkdown

Another choice for literate programming is to build documents based on [Markdown](https://en.wikipedia.org/wiki/Markdown) language. A markdown file is a plain text file that is typically given the extension `.md.`. The [`rmarkdown`](https://CRAN.R-project.org/package=rmarkdown) R package takes a R Markdown file (`.Rmd`) and weaves together R code chunks like this:

    ```{r plot1, height=4, width=5, eval=FALSE, echo=TRUE}`r ''`
    data(airquality)
    plot(airquality$Ozone ~ airquality$Wind)
    ```

::: callout-tip
The best resource for learning about R Markdown this by Yihui Xie, J. J. Allaire, and Garrett Grolemund:

-   <https://bookdown.org/yihui/rmarkdown>

The R Markdown Cookbook by Yihui Xie, Christophe Dervieux, and Emily Riederer is really good too:

-   <https://bookdown.org/yihui/rmarkdown-cookbook>

The authors of the 2nd book describe the motivation for the 2nd book as:

> "However, we have received comments from our readers and publisher that it would be beneficial to provide more practical and relatively short examples to show the interesting and useful usage of R Markdown, because it can be daunting to find out how to achieve a certain task from the aforementioned reference book (put another way, that book is too dry to read). As a result, this cookbook was born."
:::

Because this is lecture is built in a `.qmd` file (which is very similar to a `.Rmd` file), let's demonstrate how this work. I am going to change `eval=FALSE` to `eval=TRUE`.

```{r plot2, height=4, width=5, eval=TRUE, echo=TRUE}
data(airquality)
plot(airquality$Ozone ~ airquality$Wind)
```

:::{.callout-tip}

### Questions
1.  Why do we not see the back ticks \`\`\` anymore in the code chunk above that made the plot?
2.  What do you think we should do if we want to have the code executed, but we want to hide the code that made it?
:::

Before we leave this section, I find that there is quite a bit of terminology to understand the magic behind `rmarkdown` that can be confusing, so let's break it down:

-   [Pandoc](https://pandoc.org). Pandoc is a command line tool with no GUI that converts documents (e.g. from number of different markup formats to many other formats, such as .doc, .pdf etc). It is completely independent from R (but does come bundled with RStudio). If you donʻt have Rstudio installed, you will have to install `pandoc`.
-   [Markdown](https://en.wikipedia.org/wiki/Markdown) (**markup language**). Markdown is a lightweight [markup language](https://en.wikipedia.org/wiki/Markup_language) with plain text formatting syntax designed so that it can be converted to HTML and many other formats. A markdown file is a plain text file that is typically given the extension `.md.` It is completely independent from R.
-   [`markdown`](https://CRAN.R-project.org/package=markdown) (**R package**). `markdown` is an R package which converts `.md` files into HTML. It is no longer recommended for use has been surpassed by [`rmarkdown`](https://CRAN.R-project.org/package=rmarkdown) (discussed below).
-   R Markdown (**markup language**). R Markdown is an extension of the markdown syntax. R Markdown files are plain text files that typically have the file extension `.Rmd`.
-   [`rmarkdown`](https://CRAN.R-project.org/package=rmarkdown) (**R package**). The R package `rmarkdown` is a library that uses pandoc to process and convert `.Rmd` files into a number of different formats. This core function is `rmarkdown::render()`. **Note**: this package only deals with the markdown language. If the input file is e.g. `.Rhtml` or `.Rnw`, then you need to use `knitr` prior to calling pandoc (see below).

::: callout-tip
Check out the R Markdown Quick Tour for more:

-   <https://rmarkdown.rstudio.com/authoring_quick_tour.html>
:::

![Artwork by Allison Horst on RMarkdown](https://github.com/allisonhorst/stats-illustrations/raw/main/rstats-artwork/rmarkdown_rockstar.png){width="80%"}

### knitr

One of the alternative that has come up in recent times is something called `knitr`.

- The `knitr` package for R takes a lot of these ideas of literate programming and updates and improves upon them.
- `knitr` still uses R as its programming language, but it allows you to mix other programming languages in.
- You can also use a variety of documentation languages now, such as LaTeX, markdown and HTML.
- `knitr` was developed by Yihui Xie while he was a graduate student at Iowa State and it has become a very popular package for writing literate statistical programs.

Knitr takes a plain text document with embedded code, executes the code and 'knits' the results back into the document.

For for example, it converts

-   An R Markdown (`.Rmd)` file into a standard markdown file (`.md`)
-   An `.Rnw` (Sweave) file into to `.tex` format.
-   An `.Rhtml` file into to `.html`.

The core function is `knitr::knit()` and by default this will look at the input document and try and guess what type it is e.g. `Rnw`, `Rmd` etc.

This core function performs three roles:

-   A **source parser**, which looks at the input document and detects which parts are code that the user wants to be evaluated.
-   A **code evaluator**, which evaluates this code
-   An **output renderer**, which writes the results of evaluation back to the document in a format which is interpretable by the raw output type. For instance, if the input file is an `.Rmd`, the output render marks up the output of code evaluation in `.md` format.

```{r rmarkdown-wizards, echo = FALSE, fig.cap = "Converting a Rmd file to many outputs using knitr and pandoc", out.width = '60%', fig.align='center', preview=TRUE}
knitr::include_graphics("https://d33wubrfki0l68.cloudfront.net/61d189fd9cdf955058415d3e1b28dd60e1bd7c9b/9791d/images/rmarkdownflow.png")
```

\[[Source](https://rmarkdown.rstudio.com/authoring_quick_tour.html)\]

As seen in the figure above, from there pandoc is used to convert e.g. a `.md` file into many other types of file formats into a `.html`, etc.

So in summary:

> "R Markdown stands on the shoulders of knitr and Pandoc. The former executes the computer code embedded in Markdown, and converts R Markdown to Markdown. The latter renders Markdown to the output format you want (such as PDF, HTML, Word, and so on)."

\[[Source](https://bookdown.org/yihui/rmarkdown/)\]

# In comes Quarto

The folks who developed R Markdown have moved on to a new package called [Quarto](https://quarto.org). Quarto contains many of the features of R Markdown, but importantly, is now separate from Rstudio. It is intentionally developed as a cross-platform, cross-language markup language. It works with R, Python, Julia, and Observable. And is rapidly catching on with the statistical coding community.

Quarto can render output to many formats of documents including html, pdf, docx, md. It can also layout websites, presentations, or even books. It supports interactive apps such as Rshiny among other things.

We are going to learn using Quarto. Letʻs start by getting a simple webpage up.

1.  Create a Website in Quarto quickstart *up to and including Render* <https://quarto.org/docs/websites/>
2.  Publishing to GitHub *up to and including Render to docs* <https://quarto.org/docs/publishing/github-pages.html>

::: callout-tip
- **Always always** `quarto render` before you push up your changes to GitHub!
:::

**Please see [Stephanie Hicksʻ lecture for more examples and tips](https://www.stephaniehicks.com/jhustatcomputing2022/posts/2022-09-01-literate-programming/#create-and-knit-your-first-r-markdown-document)**

# Post-lecture materials

### Final Questions

Here are some post-lecture questions to help you think about the material discussed.

::: questions
### Questions

1.  What is literate programming?

2.  What was the first literate statistical programming tool to weave together a statistical language (R) with a markup language (LaTeX)?

3.  What is `knitr` and how is different than other literate statistical programming tools?

4.  Where can you find a list of other commands that help make your code writing more efficient in RStudio?
:::

### Additional Resources

::: callout-tip
-   [Literate statistical practice](http://www.r-project.org/conferences/DSC-2001/Proceedings/Rossini.pdf))
-   The introduction of Sweave by Friedrich Leisch in [2001 pg. 28](https://cran.r-project.org/doc/Rnews/Rnews_2002-3.pdf)
-   [RMarkdown Tips and Tricks](https://indrajeetpatil.github.io/RmarkdownTips/) by Indrajeet Patil
-   <https://bookdown.org/yihui/rmarkdown>
-   <https://bookdown.org/yihui/rmarkdown-cookbook>
:::
